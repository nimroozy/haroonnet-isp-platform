#
# HaroonNet ISP Platform - FreeRADIUS Main Configuration
# Optimized for high-performance ISP operations with MySQL integration
#

prefix = /usr
exec_prefix = /usr
sysconfdir = /etc
localstatedir = /var
sbindir = ${exec_prefix}/sbin
logdir = /var/log/freeradius
raddbdir = /etc/freeradius/3.0
radacctdir = ${logdir}/radacct

name = freeradius
confdir = ${raddbdir}
modconfdir = ${confdir}/mods-config
certdir = ${confdir}/certs
cadir   = ${confdir}/certs
run_dir = ${localstatedir}/run/${name}

# pidfile: Where to place the PID of the RADIUS server.
pidfile = ${run_dir}/${name}.pid

# panic_action: Command to execute in case of server crash.
panic_action = "gdb ${sbindir}/radiusd %{pid} %{panic_action}"

# max_request_time: The maximum time (in seconds) to handle a request.
max_request_time = 30

# cleanup_delay: The time to wait (in seconds) before cleaning up
# a reply which was sent to the NAS.
cleanup_delay = 5

# max_requests: The maximum number of requests which the server keeps
# track of. This should be 256 multiplied by the number of clients.
max_requests = 16384

# listen: Make the server listen on a particular IP address, and send
# replies out from that address.
listen {
	type = auth
	ipaddr = *
	port = 1812
}

listen {
	type = acct
	ipaddr = *
	port = 1813
}

# hostname_lookups: Log the names of clients or just their IP addresses
hostname_lookups = no

# Core dumps are a bad thing. This should only be set to 'yes'
# if you're debugging a problem with the server.
allow_core_dumps = no

# regular_expressions: use regular expressions
regular_expressions = yes

# extended_expressions: use the new (correct) regular expressions
extended_expressions = yes

# Log the full User-Name attribute, as it was found in the request.
log_stripped_names = no

# Log authentication requests to the log file.
log_auth = yes

# Log passwords with the authentication requests.
log_auth_badpass = no
log_auth_goodpass = no

# Log additional text at the end of the "Login OK" messages.
log_auth_pass_accept = no

# usercollide: Turn "username collision" code on and off.
usercollide = no

# lower_user / lower_pass:
# Lower case the username/password before performing any operation on it.
lower_user = no
lower_pass = no

# nospace_user / nospace_pass:
# Remove spaces from the username/password before performing any operation on it.
nospace_user = no
nospace_pass = no

# checkrad: Program to check if a user is already logged in.
checkrad = ${sbindir}/checkrad

# SECURITY CONFIGURATION
security {
	# chroot: directory where the server does "chroot".
	# chroot = /path/to/chroot/directory

	# user/group: The name (or #number) of the user/group to run radiusd as.
	user = freerad
	group = freerad

	# allow_core_dumps: whether the server is allowed to dump core.
	allow_core_dumps = no

	# max_attributes: The maximum number of attributes permitted in a RADIUS packet.
	max_attributes = 200

	# reject_delay: When sending an Access-Reject, it can be delayed for a few seconds.
	reject_delay = 1

	# status_server: Turn on/off the Status-Server functionality.
	status_server = yes

	# allow_vulnerable_openssl: Allow the server to start with versions of OpenSSL
	# known to have critical security issues.
	allow_vulnerable_openssl = no
}

# PROXY CONFIGURATION (if needed)
proxy_requests = no

# THREAD POOL CONFIGURATION
thread pool {
	# start_servers: Number of server processes to start initially.
	start_servers = 5

	# max_servers: Maximum number of server processes.
	max_servers = 32

	# min_spare_servers: Minimum number of spare server processes.
	min_spare_servers = 3

	# max_spare_servers: Maximum number of spare server processes.
	max_spare_servers = 10

	# max_requests_per_server: Maximum number of requests each server process handles.
	max_requests_per_server = 0

	# max_queue_size: Maximum number of requests in the queue.
	max_queue_size = 65536

	# auto_limit_acct: Automatically limit accounting requests.
	auto_limit_acct = no
}

######################################################################
# MODULES CONFIGURATION
######################################################################

# Load modules
modules {
	$INCLUDE mods-enabled/
}

# Instantiate modules
instantiate {
	# Load the SQL module instance
	sql

	# Load other essential modules
	expr
	expiration
	logintime
	pap
	chap
	mschap
	digest
	unix
	eap
	preprocess
	files
	detail
	radutmp
	attr_filter
	always
}

######################################################################
# POLICIES
######################################################################
policy {
	$INCLUDE policy.d/
}

######################################################################
# VIRTUAL SERVERS
######################################################################

# Include all enabled sites
$INCLUDE sites-enabled/

######################################################################
# CLIENT CONFIGURATION
######################################################################

# Include client definitions
$INCLUDE clients.conf

######################################################################
# LOGGING CONFIGURATION
######################################################################

# Destination for log messages
log {
	# destination: "files", "syslog", "stdout", or "stderr"
	destination = files

	# colourise: Highlight important messages
	colourise = yes

	# file: The logging file if destination == "files"
	file = ${logdir}/radius.log

	# syslog_facility: Syslog facility if destination == "syslog"
	syslog_facility = daemon

	# stripped_names: Log the full User-Name or the stripped one
	stripped_names = no

	# auth: Log authentication requests to the log file
	auth = yes

	# auth_badpass: Log passwords for failed authentications
	auth_badpass = no

	# auth_goodpass: Log passwords for successful authentications
	auth_goodpass = no

	# msg_goodpass: Message for successful authentication
	msg_goodpass = ""

	# msg_badpass: Message for failed authentication
	msg_badpass = ""

	# msg_denied: Message when request is denied
	msg_denied = "You are already logged in - access denied"
}

######################################################################
# PERFORMANCE TUNING
######################################################################

# Optimize for high-load ISP environment
max_request_time = 30
cleanup_delay = 5
max_requests = 16384

# Enable detailed logging for debugging (disable in production)
log_stripped_names = no
log_auth = yes
log_auth_badpass = no
log_auth_goodpass = no
